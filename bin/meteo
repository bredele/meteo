#!/usr/bin/env node

var request = require('superagent'),
		program = require('commander'),
		write = require('fs').writeFile,
		resolve = require('path').resolve,
		conf = require('../etc/conf.json')

function log(msg, color){
  color = color || '36';
  var w = 10;
  console.log('  \033[' + color + 'm%s\033[m',  msg);
}

/**
 * Usage.
 */

program
  .version(require('../package.json').version)
  .option('-l, --location <location>', 'weather location')
  .option('-u, --unit <unit>', 'temperature unit')  
  program.parse(process.argv);

conf.city = program.location || conf.city;
conf.unit = program.unit || conf.unit;

write(resolve(__dirname, '../etc/conf.json'), JSON.stringify(conf), function (err) {
  if (err) throw err;
});

request.get('http://api.openweathermap.org/data/2.5/weather?q=' + conf.city + '&units=metric&mode=json', function(res){
	var weather = JSON.parse(res.text);
	log(conf.city);
	log('  ' + weather.weather[0].description);
	log('  ' + weather.main.temp + 'Â°C', '34');
});